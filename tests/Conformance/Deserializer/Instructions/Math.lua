--!ctx Luau

local ok, compileResult = Luau.compile([[
-- tests: LOP_ADD, LOP_SUB, LOP_MUL, LOP_DIV, LOP_MOD, LOP_POW, LOP_ADDK, LOP_SUBK, LOP_MULK, LOP_DIVK, LOP_MODK, LOP_POWK, LOP_SUBRK, LOP_DIVRK, LOP_IDIV, LOP_IDIVK, LOP_MINUS

local t = {}

t.a = 1
t.b = 2

-- ADD
assert(t.a + t.b == 3, "Failed ADD")
-- SUB
assert(t.a - t.b == -1, "Failed SUB")
-- MUL
assert(t.a * t.b == 2, "Failed MUL")
-- DIV
assert(t.a / t.b == 0.5, "Failed DIV")
-- MOD
assert(t.a % t.b == 1, "Failed MOD")
-- POW
assert(t.a ^ t.b == 1, "Failed POW")

-- ADDK
assert(t.a + 2 == 3, "Failed ADDK")
-- SUBK
assert(t.a - 2 == -1, "Failed SUBK")
-- MULK
assert(t.a * 2 == 2, "Failed MULK")
-- DIVK
assert(t.a / 2 == 0.5, "Failed DIVK")
-- MODK
assert(t.a % 2 == 1, "Failed MODK")
-- POWK
assert(t.a ^ 2 == 1, "Failed POWK")

-- SUBRK
assert(2 - t.a == 1, "Failed SUBRK")
-- DIVRK
assert(2 / t.a == 2, "Failed DIVRK")

-- IDIV
assert(t.a // t.b == 0, "Failed IDIV")
-- IDIVK
assert(t.a // 2 == 0, "Failed IDIVK")

-- MINUS
assert(-t.a == -1, "Failed MINUS")

OK()
]], {
	optmizationLevel = 2,
	debugLevel = 2,
	coverageLevel = 0,
	vectorLib = nil,
	vectorCtor = nil,
	vectorType = nil,
})

if not ok then
	error(`Failed to compile, error: {compileResult}`)
end

local encodedModule, constantList, stringList = [[
	1; 1; 0 6 0 0 1 1 ? 250 29 0 [] {
		65 1 0 ? 0 ? ? ? ? ? ? ? ? ? ? ?; 53 2 0 0 0 2 ? ? ? ? ? ? ? ? ? 1; ~ 0; 4 4 0 ? 1 ? ? 1 ? ? ? ? ? ? ? ?
		16 3 1 0 1 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 4 4 0 ? 1 ? ? 2 ? ? ? ? ? ? ? ?; 16 3 1 1 1 0 131 ? ? 2 ? ? ? ? ? 1
		~ 1; 15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 15 3 1 1 5 0 131 ? ? 2 ? ? ? ? ? 1
		~ 1; 33 3 0 ? 3 4 5 ? ? ? ? ? ? ? ? ?; 79 4 6 2 3 ? ? 2 ? 3 ? ? ? 0 ? 1; ~ 2
		3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 3 1 2 4 ? ? 4 ? ? ? ? ? 1; ~ 3
		5 4 3 ? 3 ? ? 3 ? 4 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?
		15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 15 3 1 1 5 0 131 ? ? 2 ? ? ? ? ? 1; ~ 1
		34 3 0 ? 3 4 5 ? ? ? ? ? ? ? ? ?; 79 4 6 6 3 ? ? 2 ? 7 ? ? ? 0 ? 1; ~ 6; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?
		3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 7 1 2 4 ? ? 8 ? ? ? ? ? 1; ~ 7; 5 4 3 ? 3 ? ? 7 ? 8 ? ? ? ? ? ?
		12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1
		~ 0; 15 3 1 1 5 0 131 ? ? 2 ? ? ? ? ? 1; ~ 1; 35 3 0 ? 3 4 5 ? ? ? ? ? ? ? ? ?
		79 4 6 8 3 ? ? 2 ? 9 ? ? ? 0 ? 1; ~ 8; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?
		75 3 1 9 1 2 4 ? ? 10 ? ? ? ? ? 1; ~ 9; 5 4 3 ? 3 ? ? 9 ? 10 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1
		~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0
		15 3 1 1 5 0 131 ? ? 2 ? ? ? ? ? 1; ~ 1; 36 3 0 ? 3 4 5 ? ? ? ? ? ? ? ? ?; 79 4 6 10 3 ? ? 2 ? 11 ? ? ? 0 ? 1
		~ 10; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 11 1 2 4 ? ? 12 ? ? ? ? ? 1
		~ 11; 5 4 3 ? 3 ? ? 11 ? 12 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128
		21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 15 3 1 1 5 0 131 ? ? 2 ? ? ? ? ? 1
		~ 1; 37 3 0 ? 3 4 5 ? ? ? ? ? ? ? ? ?; 79 4 6 12 3 ? ? 2 ? 13 ? ? ? 0 ? 1; ~ 12
		3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 13 1 2 4 ? ? 14 ? ? ? ? ? 1; ~ 13
		5 4 3 ? 3 ? ? 13 ? 14 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?
		15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 15 3 1 1 5 0 131 ? ? 2 ? ? ? ? ? 1; ~ 1
		38 3 0 ? 3 4 5 ? ? ? ? ? ? ? ? ?; 79 4 6 12 3 ? ? 2 ? 13 ? ? ? 0 ? 1; ~ 12; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?
		3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 14 1 2 4 ? ? 15 ? ? ? ? ? 1; ~ 14; 5 4 3 ? 3 ? ? 14 ? 15 ? ? ? ? ? ?
		12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1
		~ 0; 39 3 2 ? 3 4 8 ? ? 9 ? ? ? ? ? ?; 79 4 6 2 3 ? ? 2 ? 3 ? ? ? 0 ? 1; ~ 2
		3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 15 1 2 4 ? ? 16 ? ? ? ? ? 1; ~ 15
		5 4 3 ? 3 ? ? 15 ? 16 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?
		15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 40 3 2 ? 3 4 8 ? ? 9 ? ? ? ? ? ?; 79 4 6 6 3 ? ? 2 ? 7 ? ? ? 0 ? 1
		~ 6; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 16 1 2 4 ? ? 17 ? ? ? ? ? 1
		~ 16; 5 4 3 ? 3 ? ? 16 ? 17 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128
		21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 41 3 2 ? 3 4 8 ? ? 9 ? ? ? ? ? ?
		79 4 6 8 3 ? ? 2 ? 9 ? ? ? 0 ? 1; ~ 8; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?
		75 3 1 17 1 2 4 ? ? 18 ? ? ? ? ? 1; ~ 17; 5 4 3 ? 3 ? ? 17 ? 18 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1
		~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0
		42 3 2 ? 3 4 8 ? ? 9 ? ? ? ? ? ?; 79 4 6 10 3 ? ? 2 ? 11 ? ? ? 0 ? 1; ~ 10; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?
		3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 18 1 2 4 ? ? 19 ? ? ? ? ? 1; ~ 18; 5 4 3 ? 3 ? ? 18 ? 19 ? ? ? ? ? ?
		12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1
		~ 0; 43 3 2 ? 3 4 8 ? ? 9 ? ? ? ? ? ?; 79 4 6 12 3 ? ? 2 ? 13 ? ? ? 0 ? 1; ~ 12
		3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 19 1 2 4 ? ? 20 ? ? ? ? ? 1; ~ 19
		5 4 3 ? 3 ? ? 19 ? 20 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?
		15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 44 3 2 ? 3 4 8 ? ? 9 ? ? ? ? ? ?; 79 4 6 12 3 ? ? 2 ? 13 ? ? ? 0 ? 1
		~ 12; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 20 1 2 4 ? ? 21 ? ? ? ? ? 1
		~ 20; 5 4 3 ? 3 ? ? 20 ? 21 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128
		21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 4 4 0 ? 4 ? ? 2 ? ? ? ? ? ? ? ?; 15 3 1 0 5 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0
		34 3 0 ? 3 4 5 ? ? ? ? ? ? ? ? ?; 79 4 6 12 3 ? ? 2 ? 13 ? ? ? 0 ? 1; ~ 12; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?
		3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 21 1 2 4 ? ? 22 ? ? ? ? ? 1; ~ 21; 5 4 3 ? 3 ? ? 21 ? 22 ? ? ? ? ? ?
		12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 4 4 0 ? 4 ? ? 2 ? ? ? ? ? ? ? ?
		15 3 1 0 5 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 36 3 0 ? 3 4 5 ? ? ? ? ? ? ? ? ?; 79 4 6 8 3 ? ? 2 ? 9 ? ? ? 0 ? 1
		~ 8; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 22 1 2 4 ? ? 23 ? ? ? ? ? 1
		~ 22; 5 4 3 ? 3 ? ? 22 ? 23 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128
		21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 15 3 1 1 5 0 131 ? ? 2 ? ? ? ? ? 1
		~ 1; 81 3 0 ? 3 4 5 ? ? ? ? ? ? ? ? ?; 79 4 6 23 3 ? ? 2 ? 24 ? ? ? 0 ? 1; ~ 23
		3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 24 1 2 4 ? ? 25 ? ? ? ? ? 1; ~ 24
		5 4 3 ? 3 ? ? 24 ? 25 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?
		15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 82 3 2 ? 3 4 8 ? ? 9 ? ? ? ? ? ?; 79 4 6 23 3 ? ? 2 ? 24 ? ? ? 0 ? 1
		~ 23; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?; 75 3 1 25 1 2 4 ? ? 26 ? ? ? ? ? 1
		~ 25; 5 4 3 ? 3 ? ? 25 ? 26 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1; ~ 1077936128
		21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 15 3 1 0 4 0 128 ? ? 1 ? ? ? ? ? 1; ~ 0; 51 2 0 ? 3 4 ? ? ? ? ? ? ? ? ? ?
		79 4 6 6 3 ? ? 2 ? 7 ? ? ? 0 ? 1; ~ 6; 3 3 0 ? 2 0 1 ? ? ? ? ? ? ? ? ?; 3 3 0 ? 2 1 0 ? ? ? ? ? ? ? ? ?
		75 3 1 26 1 2 4 ? ? 27 ? ? ? ? ? 1; ~ 26; 5 4 3 ? 3 ? ? 26 ? 27 ? ? ? ? ? ?; 12 4 4 1077936128 1 ? ? 5 ? ? 5 ? ? ? 1 1
		~ 1077936128; 21 3 0 ? 1 3 1 ? ? ? ? ? ? ? ? ?; 12 4 4 1102053376 1 ? ? 28 ? ? 28 ? ? ? 1 1; ~ 1102053376
		21 3 0 ? 1 1 1 ? ? ? ? ? ? ? ? ?; 22 2 0 ? 0 1 ? ? ? ? ? ? ? ? ? ?
	}]], {
		{ "1","2",3,"3","4",1077936128,-1,"5",2,"6",0.5,"7",1,"8","9","10","11","12","13","14",
			"15","16","17",0,"18","19","20","21",1102053376,
		},
	}, {
		"\97","\98","\70\97\105\108\101\100\32\65\68\68","\97\115\115\101\114\116","\70\97\105\108\101\100\32\83\85\66",
		"\70\97\105\108\101\100\32\77\85\76","\70\97\105\108\101\100\32\68\73\86","\70\97\105\108\101\100\32\77\79\68",
		"\70\97\105\108\101\100\32\80\79\87","\70\97\105\108\101\100\32\65\68\68\75","\70\97\105\108\101\100\32\83\85\66\75",
		"\70\97\105\108\101\100\32\77\85\76\75","\70\97\105\108\101\100\32\68\73\86\75","\70\97\105\108\101\100\32\77\79\68\75",
		"\70\97\105\108\101\100\32\80\79\87\75","\70\97\105\108\101\100\32\83\85\66\82\75","\70\97\105\108\101\100\32\68\73\86\82\75",
		"\70\97\105\108\101\100\32\73\68\73\86","\70\97\105\108\101\100\32\73\68\73\86\75","\70\97\105\108\101\100\32\77\73\78\85\83",
		"\79\75","\116",
	}

assert(MATCH(
	Fiu.luau_deserialize(compileResult),
	FiuUtils.decodeModule(encodedModule, constantList, stringList)
))

OK()
